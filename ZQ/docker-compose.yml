version: '3.8'

services:
  # FastAPI服务（命名为kg-backend）
  kg-backend:
    build: .  # 基于当前文件夹的Dockerfile构建镜像
    container_name: kg-backend
    ports:
      - "8000:8000"  # 本地8000端口 → 容器8000端口
    depends_on:
      - neo4j  # 先启动Neo4j，再启动FastAPI
    networks:
      - kg-network
    restart: always

  # Neo4j数据库服务
  neo4j:
    image: neo4j:5.15.0  # 稳定版镜像
    container_name: neo4j
    ports:
      - "7474:7474"  # Neo4j网页端
      - "7687:7687"  # Neo4j bolt协议端口
    environment:
      - NEO4J_AUTH=neo4j/zhangqin123  # 和你代码里的密码一致
      - NEO4J_dbms_security_procedures_unrestricted=apoc.*
      - NEO4J_dbms_memory_heap_initial_size=512m
      - NEO4J_dbms_memory_heap_max_size=1G
    volumes:
      - neo4j-data:/data  # 持久化数据（本地测试也保留）
    networks:
      - kg-network
    restart: always

# 自定义网络（让两个容器互通）
networks:
  kg-network:
    driver: bridge

# 数据卷（保存Neo4j数据）
volumes:
  neo4j-data: